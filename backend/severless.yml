service: fastapi-backend

provider:
  name: aws
  runtime: python3.9
  region: us-east-1
  environment:
    REDSHIFT_DB: ${env:REDSHIFT_DB}
    REDSHIFT_USER: ${env:REDSHIFT_USER}
    REDSHIFT_PASSWORD: ${env:REDSHIFT_PASSWORD}
    REDSHIFT_HOST: ${env:REDSHIFT_HOST}

functions:
  averageDailyConsumption:
    timeout: 900
    handler: app/functions/averageDailyConsumption.handler
    events:
      - http:
          path: average-daily-consumption
          method: GET
          authorizer: ${self:custom.authorizer}
          cors: true

plugins:
  - serverless-wsgi
  - serverless-python-requirements

custom:
  wsgi:
    app: app.main.app
    packRequirements: true

  pythonRequirements:
    dockerizePip: true